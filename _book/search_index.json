[["시계열-데이터-타입-및-import.html", "Chapter 2 시계열 데이터 타입 및 Import 2.1 날짜/시간 객체 타입 2.2 시계열 패키지 및 데이터 타입 2.3 데이터 Import의 두가지 방법", " Chapter 2 시계열 데이터 타입 및 Import 2.1 날짜/시간 객체 타입 시계열 객체 타입에는 반드시 시간을 표기하는 데이터가 인덱스로 사용되어야 함. R에는 시간을 표기하는 다양한 객체가 존재함 Date class : R base에서 기본적으로 제공하는 객체 타입으로 1970년 이후의 달력상의 날짜 수를 기록하는 데이터 타입으로 양수일 경우 1970년 이후의 날짜이며 음수인 경우 1970년 이전의 날짜를 표시함. Date class는 실제 R내부에 저장시에는 정수형태로 저장됨. Date 객체의 기본적인 표현 방식은 ‘yyyy-mm-dd’ 형태임. as.Date(&#39;2021-01-31&#39;) ## [1] &quot;2021-01-31&quot; unclass(as.Date(&#39;2021-01-31&#39;)) ## [1] 18658 library(zoo) as.Date(10000) # zoo 패키지에서 as.Date를 overriding하므로 zoo 패키지가 없으면 error ## [1] &quot;1997-05-19&quot; Sys.Date() # today ## [1] &quot;2021-01-31&quot; Sys.Date() + 10 # 오늘로부터 10일 후 ## [1] &quot;2021-02-10&quot; POSIXct, POSIXlt class : Date 객체는 1970년 이후 날짜를 기록하는 객체이지만 POSIXct 객체와 POSIXlt 객체는 1970년 이후 시간을 초단위로 기록하는 객체임. POSIXct는 정수형태로 기록되는 객체이고 POSIXlt는 리스트형태로 기록되는 객체임 as.POSIXct(&#39;2021-01-31 12:34:56&#39;) ## [1] &quot;2021-01-31 12:34:56 KST&quot; unclass(as.POSIXct(&#39;2021-01-31 12:34:55&#39;)) ## [1] 1612064095 ## attr(,&quot;tzone&quot;) ## [1] &quot;&quot; unclass(as.POSIXct(&#39;2021-01-31 12:34:56&#39;)) ## [1] 1612064096 ## attr(,&quot;tzone&quot;) ## [1] &quot;&quot; as.POSIXlt(&#39;2021-01-31 12:34:56&#39;) ## [1] &quot;2021-01-31 12:34:56 KST&quot; unclass(as.POSIXlt(&#39;2021-12-31 12:34:56&#39;)) ## $sec ## [1] 56 ## ## $min ## [1] 34 ## ## $hour ## [1] 12 ## ## $mday ## [1] 31 ## ## $mon ## [1] 11 ## ## $year ## [1] 121 ## ## $wday ## [1] 5 ## ## $yday ## [1] 364 ## ## $isdst ## [1] 0 ## ## $zone ## [1] &quot;KST&quot; ## ## $gmtoff ## [1] NA as.POSIXlt(&#39;2021-12-31 12:34:56&#39;)$year ## [1] 121 yearmon, yearqtr class : yearmon과 yearqtr 객체는 모두 zoo 패키지에서 제공하는 객체로 yearmon 객체는 월별 데이터를 표현하는 객체이고 yearqtr는 분기 데이터를 표현하는 객체임. yearmon 객체는 1월을 0으로 2월을 1/12 = 0.083, 12월을 11/12 = 0.917 으로 표기하고 yearqtr 객체는 각 분기마다 0.25씩 더해서 저장됨. as.yearmon(&quot;2007-02&quot;) ## [1] &quot;2 2007&quot; as.yearmon(&quot;2007-12&quot;) ## [1] &quot;12 2007&quot; unclass(as.yearmon(&quot;2007-02&quot;)) ## [1] 2007.083 unclass(as.yearmon(&quot;2007-02-01&quot;)) ## [1] 2007.083 unclass(as.yearmon(&quot;2007-12&quot;)) ## [1] 2007.917 as.yearqtr(&quot;2007-01&quot;) ## [1] &quot;2007 Q1&quot; as.yearqtr(&quot;2007-04&quot;) ## [1] &quot;2007 Q4&quot; unclass(as.yearqtr(&quot;2007-01&quot;)) ## [1] 2007 unclass(as.yearqtr(&quot;2007-04&quot;)) ## [1] 2007.75 날짜, 시간 객체 표현 포맷 날짜와 시간을 표현하는 방법은 매우 여러가지가 있음. R에서는 format 함수의 표준 코드를 사용하여 날짜, 시간의 표현 방법을 다양하게 변경할 수 있음. 또한 R의 지역설정에 따라 표현되는 날짜 형태도 다름. 우리나라 지역설정으로는 %B, %b는 ‘January,’ ‘Jan’ 이 아닌 ’1월’로 표기됨. standard date format codes Code Value Example %d 월의 날짜(정수) 23 %m 월(정수) 12 %B 전체 월 이름 January %b 축약형 월 이름 Jan %Y 4자리 연도 2010 %y 2자리 연도 10 as.Date(&#39;01/12/2010&#39;, format = &#39;%d/%m/%Y&#39;) ## [1] &quot;2010-12-01&quot; as.Date(&#39;01jan21&#39;, format = &#39;%d%b%y&#39;) ## [1] NA Sys.setlocale(&quot;LC_ALL&quot;, &quot;English&quot;) ## [1] &quot;LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MONETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252&quot; as.Date(&#39;01jan21&#39;, format = &#39;%d%b%y&#39;) ## [1] &quot;2021-01-01&quot; Sys.setlocale(&quot;LC_ALL&quot;, &quot;Korean&quot;) ## [1] &quot;LC_COLLATE=Korean_Korea.949;LC_CTYPE=Korean_Korea.949;LC_MONETARY=Korean_Korea.949;LC_NUMERIC=C;LC_TIME=Korean_Korea.949&quot; as.Date(&#39;011월21&#39;, format = &#39;%d%b%y&#39;) ## [1] &quot;2021-01-01&quot; 2.2 시계열 패키지 및 데이터 타입 R에서는 일반적으로 data.frame 객체로 데이터를 저장하는 경우가 많은데 시계열 객체는 시간 인덱스를 기반으로 검색, 분할, 집계, 병합과 같은 데이터 핸들링이 이루어지는데 data.frame에서 효과적으로 작동하지 않음. 따라서 R에서는 시간 인덱스를 기반으로 데이터를 처리하기 위한 특별한 데이터 객체를 제공하고 있음.2 R에서 많이 사용하는 시계열 객체는 대부분 패키지에서 제공하는데 많이 사용되는 시계열 패키지 및 데이터 타입은 다음과 같음. ts(data type) : ts 데이터 타입은 R에서 가장 기본적으로 활용되는 시계열 데이터 타입임. ts 데이터 타입은 ‘stats’ 패키지를 로드해야 사용할 수 있지만 R이 실행될 때 기본적으로 로드되는 패키지이기 때문에 특별한 패키지를 로드하지 않고 바로 활용할 수 있음. 또한 stats 패키지에 포함된 다양한 시계열 데이터 처리 함수를 사용할 수 있어 많이 사용됨.3 ts 타입 데이터 생성 예 (R Core Team, n.d.) ts(1:10, frequency = 4, start = c(1959, 2)) ## Qtr1 Qtr2 Qtr3 Qtr4 ## 1959 1 2 3 ## 1960 4 5 6 7 ## 1961 8 9 10 # ts - ts 객체 생성 함수 # 1:10 - ts 객체 함수에 저장되는 데이터 벡터 # frequency - ts 객체의 시간 간격을 지정하는 매개변수 # start - ts 객체의 인덱스가 되는 시간의 시작점 zoo(package &amp; data type) : 시간의 순서로 정렬된 S3 클래스의 데이터 타입으로 수치 벡터나 매트릭스와 팩터의 시계열 데이터를 표현함. zoo는 특정한 인덱스 / 날짜 / 시간 클래스의 독립성과 ts 및 기본 R과의 일관성을 확보하기 위한 표준 제네릭의 확장 방법을 제공하는 것임.4 zoo 패키지 설치 if(!require(zoo)) { install.packages(&#39;zoo&#39;) library(zoo) } zoo 타입 데이터 생성 예 zoo(rnorm(5), as.Date(&quot;2008-08-01&quot;) + 0:4) ## 2008-08-01 2008-08-02 2008-08-03 2008-08-04 2008-08-05 ## 0.08915944 1.39681433 0.05012469 -1.46249650 0.87472818 xts(package &amp; data type) : xts는 extensible time-series의 준말로 ‘xts’ 패키지를 로드해야 활용할 수 있는 데이터 타입임. 앞서 기술된 zoo 데이터 타입에 종속된 데이터 타입으로 zoo를 확장하여 다양한 시간 기반 데이터 클래스를 균일하게 처리 할 수 있는 데이터 타입임.5 xts 패키지 설치 if(!require(xts)) { install.packages(&#39;xts&#39;) library(xts) } xts 타입 데이터 생성 예 xts(rnorm(5), as.Date(&quot;2008-08-01&quot;) + 0:4) ## [,1] ## 2008-08-01 0.2107620 ## 2008-08-02 -1.2810823 ## 2008-08-03 1.7071827 ## 2008-08-04 -0.1386967 ## 2008-08-05 1.2784489 as.xts(rnorm(5), as.Date(&quot;2008-08-01&quot;) + 0:4) ## [,1] ## 2008-08-01 -0.3562332 ## 2008-08-02 -0.6379999 ## 2008-08-03 -0.9830223 ## 2008-08-04 -0.3965793 ## 2008-08-05 -1.1974231 xts()와 as.xts()의 차이 : xts()는 xts 객체를 생성하는 함수이나 as.xts()는 timeSeries, ts, irts, fts, matrix, data.frame, zoo 객체를 xts객체로 변환하는 함수임.6 다음과 같은 차이가 발생함. ts &lt;- ts(1:10, frequency = 4, start = c(1959, 2)) xts(ts) ## Error in xts(ts): order.by requires an appropriate time-based object as.xts(ts) ## [,1] ## 1959 Q2 1 ## 1959 Q3 2 ## 1959 Q4 3 ## 1960 Q1 4 ## 1960 Q2 5 ## 1960 Q3 6 ## 1960 Q4 7 ## 1961 Q1 8 ## 1961 Q2 9 ## 1961 Q3 10 ts, zoo, xts는 모두 시계열 데이터를 다루는 객체이지만 xts(zoo의 확장판)가 보다 유연한 함수가 있음. 다만 최근에는 ts 객체에도 동일하게 적용할 수 있는 함수가 제공되고 있음. 또한 xts 매뉴얼에 의하면 as.xts와 reclass를 활용하는 것이 xts를 사용하는 것보다 이익이 있다고 명기하고 있음.7 head(ts) # 시계열 데이터 형태로 보이지 않음 ## [1] 1 2 3 4 5 6 head(as.xts(ts)) # 시계열 형태로 보임 ## [,1] ## 1959 Q2 1 ## 1959 Q3 2 ## 1959 Q4 3 ## 1960 Q1 4 ## 1960 Q2 5 ## 1960 Q3 6 modeltime(package) : ‘tidymodel’과 같이 사용이 가능한 시계열 예측 프레임워크임. modeltime 패키지에서 제공하는 시계열 모델은 ARIMA, Exponential Smoothing 외에도 ’forecast’ 패키지와 ‘prophet’ 패키지에서 제공하는 추가적인 시계열 모델을 제공함.8 이 패키지는 ’tidymodel’과 같이 사용하는 기본 사상으로 특별한 시계열 데이터 타입을 제공하지 않고 tibble 데이터 타입을 사용할 수 있다는 장점이 있음. modeltime 패키지 설치 if(!require(modeltime)) { install.packages(&#39;modeltime&#39;) library(modeltime) } ## Warning: package &#39;modeltime&#39; was built under R version 4.0.3 2.3 데이터 Import의 두가지 방법 시계열(Time Series) 데이터를 R에서 직접 생성할 수도 있으나 대부분의 경우는 다양한 파일 포맷(Excel, CSV, SPSS 등)으로 저장된 파일에서 읽어들이는 방법이 일반적임. 데이터 파일에는 반드시 시계열 데이터의 인덱스로 활용할 수 있는 시간 데이터 컬럼이 필요함. 본 문서에서는 다양한 파일 포맷 중 Excel과 CSV파일에서 시계열 데이터를 읽어들여 활용하는 방법을 언급하겠음. 파일에서 시계열 데이터를 읽어들이는 방법은 크게 두가지가 있음 데이터를 파일에서 읽어들여 data.frame에 저장 후 저장된 data.frame을 시계열 데이터 타입으로 변환함. library(readxl) mydata &lt;- read_excel(&quot;exercise1.xlsx&quot;) # 엑셀 파일로부터 데이터를 읽어옴 # Look at the first few lines of mydata head(mydata) # 데이터 확인 ## # A tibble: 6 x 4 ## ...1 Sales AdBudget GDP ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Mar-81 1020. 659. 252. ## 2 Jun-81 889. 589 291. ## 3 Sep-81 795 512. 291. ## 4 Dec-81 1004. 614. 292. ## 5 Mar-82 1058. 647. 279. ## 6 Jun-82 944. 602 254 # Create a ts object called myts myts &lt;- ts(mydata[2:4], start = c(1981, 1), frequency = 4) # 읽어온 데이터를 ts 객체로 생성 class(myts) # 데이터 확인 ## [1] &quot;mts&quot; &quot;ts&quot; &quot;matrix&quot; 시계열 패키지에서 제공하는 데이터 Import 함수를 이용하여 직접 시계열 데이터 타입으로 읽어들임. 다만 xts 패키지와 modeltime 패키지는 외부 데이터를 직접 읽어 올 수 있는 방법 제공하지 않음. xts의 경우는 read.ts(tseries 패키지 필요)나 read.zoo 함수를 이용해 읽어들인 시계열 객체를 as.xts 함수를 이용하여 xts 객체로 변환하고 modeltime은 tidymodel 객체를 변환하여 사용하는 것이 일반적임. ts 객체를 읽어올때 주의할 점은 ts 객체는 파일에 기록된 시간 인덱스를 직접 시간인덱스로 사용할 수 없고 read.ts 함수 호출시 시계열 시작점과 간격을 지정함으로써 일정한 간격의 시계열 데이터를 생성해야 함. 시작점부터 일정한 간격으로 모든 데이터가 기록된 경우는 문제가 없지만 일부 데이터가 결측되는 경우 정확히 읽어들일 수 없음. library(tseries) ## Warning: package &#39;tseries&#39; was built under R version 4.0.3 df &lt;- data.frame(date = seq(as.Date(&#39;2010-01-01&#39;), length.out = 30, by = &#39;months&#39;), value1 = rnorm(30), value2 = rnorm(30)) write.csv(df[,-1], &quot;testfile_readts.csv&quot;, row.names = F) read.ts(&quot;testfile_readts.csv&quot;, header = TRUE, sep = &#39;,&#39;, start = c(2010, 1), frequency = 12) ## value1 value2 ## Jan 2010 -0.02392385 -1.553650450 ## Feb 2010 0.79139696 0.541571171 ## Mar 2010 0.37046865 -0.991629060 ## Apr 2010 0.36426665 0.414943037 ## May 2010 0.01940730 -0.997572534 ## Jun 2010 0.53559200 0.397217691 ## Jul 2010 0.71057293 0.549328075 ## Aug 2010 0.14210203 1.240988529 ## Sep 2010 1.00086547 -0.372427929 ## Oct 2010 0.27306304 -0.819542543 ## Nov 2010 -0.60986668 1.745421620 ## Dec 2010 0.43590361 1.265968942 ## Jan 2011 -0.72903554 0.348257358 ## Feb 2011 -0.53005023 0.695007974 ## Mar 2011 1.08608810 -0.008791181 ## Apr 2011 0.77480548 -0.273410985 ## May 2011 1.33937388 0.938480694 ## Jun 2011 1.46917783 2.038417979 ## Jul 2011 -0.53802782 -1.718598717 ## Aug 2011 1.16589504 1.594391945 ## Sep 2011 0.03738089 -1.461878777 ## Oct 2011 0.60359027 -1.340308182 ## Nov 2011 0.62963505 -0.712530551 ## Dec 2011 0.48852912 0.130712199 ## Jan 2012 0.42739398 0.703315287 ## Feb 2012 -1.17698271 -0.466935379 ## Mar 2012 -0.69915772 0.181096857 ## Apr 2012 -0.47342369 -0.085032287 ## May 2012 0.33892792 -0.339238675 ## Jun 2012 -0.60035696 -0.106238120 읽어들일 파일에 시간이 기재되어 있는 경우는 zoo 패키지의 read.zoo 함수를 이용하여 zoo 객체로 읽어들인 후 이 객체를 xts 객체로 변환하여 활용하는 방법을 활용할 수 있음. read.ts에 비해 read.zoo는 지정된 주기의 비일정한 시계열 데이터 타입을 불러 들일 수 있다는 장점이 있음. 예를 들어 매일 기록되는 데이터의 경우 read.ts는 중간에 빠지는 날이 없이 지정된 기간동안 매일 기록된 데이터를 가져오지만 read.zoo는 기본적으로 매일 기록된 데이터를 가져온다하더라도 중간중간 빠진 날을 인정하고 가져올 수 있는 방법임. write.csv(df, &quot;testfile_readts.csv&quot;, row.names = F) read.zoo(&quot;testfile_readts.csv&quot;, sep = &#39;,&#39;, index.column = 1, format = &#39;%Y-%m-%d&#39;, header = TRUE) ## value1 value2 ## 2010-01-01 -0.02392385 -1.553650450 ## 2010-02-01 0.79139696 0.541571171 ## 2010-03-01 0.37046865 -0.991629060 ## 2010-04-01 0.36426665 0.414943037 ## 2010-05-01 0.01940730 -0.997572534 ## 2010-06-01 0.53559200 0.397217691 ## 2010-07-01 0.71057293 0.549328075 ## 2010-08-01 0.14210203 1.240988529 ## 2010-09-01 1.00086547 -0.372427929 ## 2010-10-01 0.27306304 -0.819542543 ## 2010-11-01 -0.60986668 1.745421620 ## 2010-12-01 0.43590361 1.265968942 ## 2011-01-01 -0.72903554 0.348257358 ## 2011-02-01 -0.53005023 0.695007974 ## 2011-03-01 1.08608810 -0.008791181 ## 2011-04-01 0.77480548 -0.273410985 ## 2011-05-01 1.33937388 0.938480694 ## 2011-06-01 1.46917783 2.038417979 ## 2011-07-01 -0.53802782 -1.718598717 ## 2011-08-01 1.16589504 1.594391945 ## 2011-09-01 0.03738089 -1.461878777 ## 2011-10-01 0.60359027 -1.340308182 ## 2011-11-01 0.62963505 -0.712530551 ## 2011-12-01 0.48852912 0.130712199 ## 2012-01-01 0.42739398 0.703315287 ## 2012-02-01 -1.17698271 -0.466935379 ## 2012-03-01 -0.69915772 0.181096857 ## 2012-04-01 -0.47342369 -0.085032287 ## 2012-05-01 0.33892792 -0.339238675 ## 2012-06-01 -0.60035696 -0.106238120 Eric Zivo, Working with Financial Time Series Data in R, 2014, https://faculty.washington.edu/ezivot/econ424/Working%20with%20Time%20Series%20Data%20in%20R.pdf ts, R document , https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/ts, 2021.1.31 https://cran.r-project.org/web/packages/zoo/zoo.pdf https://cran.r-project.org/web/packages/xts/xts.pdf https://www.rdocumentation.org/packages/xts/versions/0.12.1/topics/as.xts.methods https://cran.r-project.org/web/packages/xts/xts.pdf https://cran.r-project.org/web/packages/modeltime/index.html "]]
